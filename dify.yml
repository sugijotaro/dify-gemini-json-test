app:
  description: 'ãƒ­ãƒ¼ã‚«ãƒ«ã®å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€Gemini File APIã‹ã‚‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰URLã‚’å–å¾—ã—ã¾ã™ã€‚'
  icon: ğŸ“¤ # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³
  icon_background: '#D6EAF8' # è–„ã„é’è‰²
  mode: workflow
  name: Gemini File Upload - Step 1 Get URL
  use_icon_as_answer_icon: false
dependencies: [] # å¤–éƒ¨ãƒ„ãƒ¼ãƒ«ã¯ã¾ã ä½¿ã‚ãªã„
kind: app
version: 0.2.0 # ã”æç¤ºã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆã‚ã›ã‚‹
workflow:
  conversation_variables: []
  environment_variables:
  - description: 'Google Gemini API Key'
    id: env_gemini_api_key # å®Ÿéš›ã«ã¯DifyãŒUUIDã‚’å‰²ã‚Šå½“ã¦ã¾ã™
    name: GEMINI_API_KEY
    selector:
    - env
    - GEMINI_API_KEY
    value: '' # Difyã®ç’°å¢ƒå¤‰æ•°è¨­å®šã§å®Ÿéš›ã®ã‚­ãƒ¼ã‚’ã‚»ãƒƒãƒˆ
    value_type: secret
  features:
    file_upload: # ã‚¢ãƒ—ãƒªå…¨ä½“ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰è¨­å®š
      allowed_file_extensions: # å…·ä½“çš„ãªå‹•ç”»æ‹¡å¼µå­ã‚’æŒ‡å®š
      - .MP4
      - .MOV
      - .AVI
      - .WEBM
      - .MPEG
      allowed_file_types: # videoã‚¿ã‚¤ãƒ—ã‚’è¨±å¯
      - video
      allowed_file_upload_methods: # ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚’è¨±å¯
      - local_file
      enabled: true # ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 1 # ä¸€åº¦ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«æ•°
        file_size_limit: 2000 # Difyå´ã®æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™ (MB)
        image_file_size_limit: 10
        video_file_size_limit: 2000 # å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€å¤§ã‚µã‚¤ã‚ºåˆ¶é™ (MB)
        workflow_file_upload_limit: 1 # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å…¨ä½“ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«æ•°åˆ¶é™
      image: # ç”»åƒé–¢é€£ã®è¨­å®šã¯ä»Šå›ã¯ä¸è¦ãªã®ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 1 # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’1ã«
    opening_statement: 'Gemini File APIã§å‡¦ç†ã™ã‚‹å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚'
    retriever_resource:
      enabled: false # ä»Šå›ã¯æœªä½¿ç”¨
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
  graph:
    edges:
    # Start -> HTTP Start Upload
    - data:
        isInLoop: false
        sourceType: start
        targetType: http-request
      id: edge_start_to_http_start_upload # ã‚¨ãƒƒã‚¸ID
      source: node_start # é–‹å§‹ãƒãƒ¼ãƒ‰ã®ID
      sourceHandle: source # é–‹å§‹ãƒãƒ¼ãƒ‰ã®å‡ºåŠ›ãƒãƒ³ãƒ‰ãƒ«
      target: node_http_start_upload # HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒ¼ãƒ‰ã®ID
      targetHandle: target # HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒ¼ãƒ‰ã®å…¥åŠ›ãƒãƒ³ãƒ‰ãƒ«
      type: custom
    # HTTP Start Upload -> End
    - data:
        isInLoop: false
        sourceType: http-request
        targetType: end
      id: edge_http_start_upload_to_end # ã‚¨ãƒƒã‚¸ID
      source: node_http_start_upload # HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒ¼ãƒ‰ã®ID
      sourceHandle: source # HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒ¼ãƒ‰ã®å‡ºåŠ›ãƒãƒ³ãƒ‰ãƒ«
      target: node_end # çµ‚äº†ãƒãƒ¼ãƒ‰ã®ID
      targetHandle: target # çµ‚äº†ãƒãƒ¼ãƒ‰ã®å…¥åŠ›ãƒãƒ³ãƒ‰ãƒ«
      type: custom

    nodes:
    - data:
        desc: 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¾ã™ã€‚'
        selected: false # UIä¸Šã§ã®é¸æŠçŠ¶æ…‹
        title: é–‹å§‹
        type: start # ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—
        variables: # å…¥åŠ›å¤‰æ•°å®šç¾©
        - allowed_file_extensions: [] # å€‹åˆ¥æŒ‡å®šã¯ä¸è¦ (features.file_uploadã§ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š)
          allowed_file_types: # ã“ã®å¤‰æ•°ã§è¨±å¯ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—
          - video
          allowed_file_upload_methods: # ã“ã®å¤‰æ•°ã§è¨±å¯ã™ã‚‹ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ–¹æ³•
          - local_file
          label: å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ« # UIä¸Šã®è¡¨ç¤ºãƒ©ãƒ™ãƒ«
          max_length: 48 # Difyã®UIä¸Šã®è¨­å®šå€¤ã€ãƒ•ã‚¡ã‚¤ãƒ«åé•·ã¨ã¯ç›´æ¥é–¢ä¿‚ãªã—
          options: []
          required: true # å¿…é ˆå…¥åŠ›
          type: file # å¤‰æ•°ã‚¿ã‚¤ãƒ—
          variable: uploaded_video_file # å¤‰æ•°å (Difyå†…éƒ¨ã§å‚ç…§)
      height: 150 # UIä¸Šã®ãƒãƒ¼ãƒ‰ã®é«˜ã•
      id: node_start # ãƒãƒ¼ãƒ‰ã®ä¸€æ„ãªID
      position: { x: 50, y: 200 } # UIä¸Šã®ãƒãƒ¼ãƒ‰ã®ä½ç½®
      type: custom # Difyã®ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—
      width: 280 # UIä¸Šã®ãƒãƒ¼ãƒ‰ã®å¹…
    - data:
        authorization: { type: no-auth } # APIã‚­ãƒ¼ã¯URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æ¸¡ã™ãŸã‚
        body: # ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£
          data: # ãƒœãƒ‡ã‚£ã®å†…å®¹ (JSONæ–‡å­—åˆ—ã¨ã—ã¦ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—)
            '{
              "file": {
                "displayName": "{{#node_start.uploaded_video_file.name#}}"
              }
            }'
          type: json # ãƒœãƒ‡ã‚£ã®ã‚¿ã‚¤ãƒ—
        desc: 'Gemini File API: Resumable uploadã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰URLã‚’å–å¾—ã—ã¾ã™ã€‚'
        headers: | # ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ (è¤‡æ•°è¡Œã§è¨˜è¿°)
          X-Goog-Upload-Protocol: resumable
          X-Goog-Upload-Command: start
          X-Goog-Upload-Header-Content-Type: {{#node_start.uploaded_video_file.mime_type#}}
          X-Goog-Upload-Header-Content-Length: {{#node_start.uploaded_video_file.size#}}
          Content-Type: application/json; charset=utf-8
        method: post # HTTPãƒ¡ã‚½ãƒƒãƒ‰
        params: 'uploadType=resumable&key={{#env.GEMINI_API_KEY#}}' # URLã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
        retry_config: { max_retries: '1', retry_enabled: false, retry_interval: 5000 } # ãƒªãƒˆãƒ©ã‚¤è¨­å®š
        title: '1. File API: Start Upload Session' # ãƒãƒ¼ãƒ‰ã®ã‚¿ã‚¤ãƒˆãƒ«
        type: http-request # ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—
        url: https://generativelanguage.googleapis.com/upload/v1beta/files # ãƒªã‚¯ã‚¨ã‚¹ãƒˆURL
      height: 260 # ãƒ˜ãƒƒãƒ€ãƒ¼ãŒå¢—ãˆãŸã®ã§å°‘ã—é«˜ã•ã‚’èª¿æ•´
      id: node_http_start_upload
      position: { x: 380, y: 200 }
      type: custom
      width: 300 # å°‘ã—å¹…ã‚’èª¿æ•´
    - data:
        desc: 'File APIé–‹å§‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®çµæœã‚’è¡¨ç¤ºã—ã¾ã™ã€‚'
        outputs: # å‡ºåŠ›å¤‰æ•°å®šç¾©
        - value_selector: # ã©ã®å€¤ã‚’å‚ç…§ã™ã‚‹ã‹
          - node_http_start_upload # å‚ç…§å…ƒãƒãƒ¼ãƒ‰ID
          - headers # å‚ç…§å…ƒãƒãƒ¼ãƒ‰ã®å‡ºåŠ› (headers)
          variable: response_headers # å‡ºåŠ›å¤‰æ•°å
        - value_selector:
          - node_http_start_upload
          - body # å‚ç…§å…ƒãƒãƒ¼ãƒ‰ã®å‡ºåŠ› (body)
          variable: response_body
        - value_selector:
          - node_http_start_upload
          - status_code # å‚ç…§å…ƒãƒãƒ¼ãƒ‰ã®å‡ºåŠ› (status_code)
          variable: status_code
        title: çµ‚äº† (Upload URLå–å¾—çµæœ)
        type: end
      height: 180 # å‡ºåŠ›ãŒå¢—ãˆãŸã®ã§é«˜ã•ã‚’èª¿æ•´
      id: node_end
      position: { x: 730, y: 200 }
      type: custom
      width: 300

    viewport: { x: 0, y: 0, zoom: 0.9 } # UIã®è¡¨ç¤ºå€ç‡ã¨ä½ç½®