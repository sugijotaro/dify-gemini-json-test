app:
  description: ãƒ­ãƒ¼ã‚«ãƒ«ã®å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€å¤‰æ•°ã‚’çµŒç”±ã—ã¦Gemini File APIã‹ã‚‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰URLã‚’å–å¾—ã—ã¾ã™ã€‚
  icon: ğŸ“¤
  icon_background: "#D6EAF8"
  mode: workflow
  name: Gemini File Upload - Step 1 with Var Check
  use_icon_as_answer_icon: false
dependencies: []
kind: app
version: 0.2.0
workflow:
  conversation_variables: []
  environment_variables:
    - description: Google Gemini API Key
      id: env_gemini_api_key
      name: GEMINI_API_KEY
      selector:
        - env
        - GEMINI_API_KEY
      value: ""
      value_type: secret
  features:
    file_upload:
      allowed_file_extensions:
        - .MP4
        - .MOV
        - .AVI
        - .WEBM
        - .MPEG
      allowed_file_types:
        - video
      allowed_file_upload_methods:
        - local_file
      enabled: true
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
          - local_file
          - remote_url
      number_limits: 1
    opening_statement: Gemini File APIã§å‡¦ç†ã™ã‚‹å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ""
      voice: ""
  graph:
    edges:
      - data:
          isInLoop: false
          sourceType: start
          targetType: code
        id: edge_start_to_code
        source: node_start
        sourceHandle: source
        target: node_code_prepare_vars
        targetHandle: target
        type: custom
      - data:
          isInLoop: false
          sourceType: code
          targetType: http-request
        id: edge_code_to_http_start_upload
        source: node_code_prepare_vars
        sourceHandle: source
        target: node_http_start_upload
        targetHandle: target
        type: custom
      - data:
          isInLoop: false
          sourceType: http-request
          targetType: end
        id: edge_http_start_upload_to_end
        source: node_http_start_upload
        sourceHandle: source
        target: node_end
        targetHandle: target
        type: custom
    nodes:
      - data:
          desc: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¾ã™ã€‚
          selected: false
          title: é–‹å§‹
          type: start
          variables:
            - allowed_file_extensions: []
              allowed_file_types:
                - video
              allowed_file_upload_methods:
                - local_file
              label: å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«
              max_length: 48
              options: []
              required: true
              type: file
              variable: uploaded_video_file
        height: 134
        id: node_start
        position:
          x: 50
          y: 200
        positionAbsolute:
          x: 50
          y: 200
        type: custom
        width: 244
      - data:
          code:
            "def main(input_mime_type: str, input_num_bytes: int, input_display_name:\
            \ str) -> dict:\n    # input_mime_type, input_num_bytes, input_display_name\
            \ ã¯\n    # Difyã®Codeãƒãƒ¼ãƒ‰ã®ã€Œå…¥åŠ›å¤‰æ•°ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å®šç¾©ã—ãŸå¤‰æ•°åã«å¯¾å¿œã—ã¾ã™ã€‚\n    # DifyãŒã“ã‚Œã‚‰ã®å€¤ã‚’å¼•æ•°ã¨ã—ã¦mainé–¢æ•°ã«æ¸¡ã—ã¦ãã‚Œã¾ã™ã€‚\n\
            \n    # ã“ã“ã§å¿…è¦ã«å¿œã˜ã¦å€¤ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã‚ŠåŠ å·¥ã—ãŸã‚Šã§ãã‚‹\n    # ä¾‹: print(f\"MIME Type: {input_mime_type}\"\
            )\n    # ä¾‹: print(f\"Num Bytes: {input_num_bytes}\")\n    # ä¾‹: print(f\"\
            Display Name: {input_display_name}\")\n\n    processed_mime_type = input_mime_type\n\
            \    processed_num_bytes = str(input_num_bytes) # HTTPãƒ˜ãƒƒãƒ€ãƒ¼ç”¨ã«æ–‡å­—åˆ—ã«å¤‰æ›\n   \
            \ processed_display_name = input_display_name\n\n    # ASCIIã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ©ãƒ¼å¯¾ç­–ã®ä¾‹\
            \ (ã‚‚ã—ãƒ•ã‚¡ã‚¤ãƒ«åãŒåŸå› ã®å ´åˆ)\n    # import re\n    # processed_display_name = re.sub(r'[^\\\
            x00-\\x7F]+', '_', input_display_name)\n\n    # è¿”ã‚Šå€¤ã®è¾æ›¸ã®ã‚­ãƒ¼ãŒã€Codeãƒãƒ¼ãƒ‰ã®ã€Œå‡ºåŠ›å¤‰æ•°ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å®šç¾©ã—ãŸå¤‰æ•°åã«å¯¾å¿œã—ã¾ã™ã€‚\n\
            \    return {\n        \"MIME_TYPE_OUT\": processed_mime_type,\n       \
            \ \"NUM_BYTES_OUT\": processed_num_bytes,\n        \"DISPLAY_NAME_OUT\"\
            : processed_display_name\n    }\n"
          code_language: python3
          desc: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ï¼ˆMIMEã‚¿ã‚¤ãƒ—, ã‚µã‚¤ã‚º, åå‰ï¼‰ã‚’æº–å‚™ãƒ»ç¢ºèªã—ã¾ã™ã€‚
          outputs:
            DISPLAY_NAME_OUT:
              type: string
            MIME_TYPE_OUT:
              type: string
            NUM_BYTES_OUT:
              type: string
          selected: false
          title: "æº–å‚™: ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±"
          type: code
          variables:
            - value_selector:
                - node_start
                - uploaded_video_file
                - mime_type
              variable: input_mime_type
            - value_selector:
                - node_start
                - uploaded_video_file
                - size
              variable: input_num_bytes
            - value_selector:
                - node_start
                - uploaded_video_file
                - name
              variable: input_display_name
        height: 220
        id: node_code_prepare_vars
        position:
          x: 332.5
          y: 200
        positionAbsolute:
          x: 332.5
          y: 200
        selected: false
        type: custom
        width: 280
      - data:
          authorization:
            type: no-auth
          body:
            data:
              - type: text
                value:
                  '{ "file": { "displayName": "{{#node_code_prepare_vars.DISPLAY_NAME_OUT#}}"
                  } }'
            type: json
          desc: "Gemini File API: Resumable uploadã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰URLã‚’å–å¾—ã—ã¾ã™ã€‚"
          headers: "X-Goog-Upload-Protocol:resumable

            X-Goog-Upload-Command:start

            X-Goog-Upload-Header-Content-Type:{{#node_code_prepare_vars.MIME_TYPE_OUT#}}

            X-Goog-Upload-Header-Content-Length:{{#node_code_prepare_vars.NUM_BYTES_OUT#}}

            Content-Type:application/json; charset=utf-8"
          method: post
          params: "uploadType:resumable

            key:{{#env.GEMINI_API_KEY#}}"
          retry_config:
            max_retries: "1"
            retry_enabled: false
            retry_interval: 5000
          selected: true
          ssl_verify: true
          timeout:
            connect: 10
            max_connect_timeout: 10
            max_read_timeout: 60
            max_write_timeout: 20
            read: 60
            write: 20
          title: "1. File API: Start Upload Session"
          type: http-request
          url: https://generativelanguage.googleapis.com/upload/v1beta/files
        height: 260
        id: node_http_start_upload
        position:
          x: 680
          y: 200
        positionAbsolute:
          x: 680
          y: 200
        selected: true
        type: custom
        width: 300
      - data:
          desc: File APIé–‹å§‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®çµæœã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
          outputs:
            - value_selector:
                - node_http_start_upload
                - headers
              variable: response_headers
            - value_selector:
                - node_http_start_upload
                - body
              variable: response_body
            - value_selector:
                - node_http_start_upload
                - status_code
              variable: status_code
            - value_selector:
                - node_code_prepare_vars
                - MIME_TYPE_OUT
              variable: prepared_mime_type
            - value_selector:
                - node_code_prepare_vars
                - NUM_BYTES_OUT
              variable: prepared_num_bytes
            - value_selector:
                - node_code_prepare_vars
                - DISPLAY_NAME_OUT
              variable: prepared_display_name
          selected: false
          title: çµ‚äº† (Upload URLå–å¾—çµæœã¨æº–å‚™å¤‰æ•°)
          type: end
        height: 240
        id: node_end
        position:
          x: 1030
          y: 200
        positionAbsolute:
          x: 1030
          y: 200
        selected: false
        type: custom
        width: 320
    viewport:
      x: 0
      y: 0
      zoom: 1
